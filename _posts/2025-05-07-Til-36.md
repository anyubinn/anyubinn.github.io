---
title: "[TIL] DAY55 LocalDateTime ë³€í™˜ ì˜¤ë¥˜, Pageable íŒŒë¼ë¯¸í„° ìˆœì„œ, QueryDSL ì¡°ì¸/ì§‘ê³„ ì´ìŠˆ í•´ê²°"
categories: [ë‚´ì¼ë°°ì›€ìº í”„, TIL]
tag: [ê°œì¸ ê³¼ì œ, ë³¸ìº í”„, Spring Boot, JPA, QueryDSL, JPQL, íŠ¸ëŸ¬ë¸”ìŠˆíŒ…]
date: 2025-05-07 12:00:00 +0900
toc_sticky: true
---
## ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
***
### ğŸ“† ìˆ˜ì •ì¼ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•  ë•Œ ì˜¤ë¥˜
ì‹œì‘ì¼(`startDate`)ê³¼ ì¢…ë£Œì¼(`endDate`)ì„ ê¸°ì¤€ìœ¼ë¡œ ê²€ìƒ‰í•˜ë ¤ê³  í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

**`Failed to convert value of type 'java.lang.String' to required type 'java.time.LocalDateTimeâ€™`**

Springì—ì„œëŠ” ë¬¸ìì—´ì„ `LocalDateTime`ìœ¼ë¡œ ìë™ ë³€í™˜í•  ìˆ˜ ìˆì§€ë§Œ, ì´ë•Œ **ì ì ˆí•œ í˜•ì‹ ì§€ì •ì´ ì—†ìœ¼ë©´ ë³€í™˜ì— ì‹¤íŒ¨**í•œë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `@DateTimeFormat` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë‚ ì§œ í˜•ì‹ì„ ëª…ì‹œí•œë‹¤. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸¸ ë•ŒëŠ” `ISO 8601` í˜•ì‹ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

```java
@DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime startDate
```

***
### âš ï¸ JPQLì—ì„œ Pageable íŒŒë¼ë¯¸í„° ìˆœì„œ ì˜¤ë¥˜

ë‹¤ìŒê³¼ ê°™ì´ `Pageable`ì„ ì•ì— ë‘ë©´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
@Query("SELECT u FROM Users u WHERE u.name = :name")
Page<Users> findByName(Pageable pageable, @Param("name") String name);
```

Spring Data JPAì—ì„œ @Queryì™€ í•¨ê»˜ ì‚¬ìš©í•  ê²½ìš° íŒŒë¼ë¯¸í„° ìˆœì„œê°€ ì¤‘ìš”í•˜ë‹¤. 

Pageableì€ ë‚´ë¶€ì ìœ¼ë¡œ íŠ¹ë³„ ì·¨ê¸‰ë˜ê¸° ë•Œë¬¸ì— JPQL ì¿¼ë¦¬ì— ë°”ì¸ë”©ë˜ëŠ” íŒŒë¼ë¯¸í„°ë³´ë‹¤ í•­ìƒ ë’¤ì— ì™€ì•¼ í•œë‹¤.

```java
@Query("SELECT u FROM Users u WHERE u.name = :name")
Page<Users> findByName(@Param("name") String name, Pageable pageable);
```

### ğŸ” QueryDSLì—ì„œ ë§¤ë‹ˆì € ì¡°íšŒ ì‹œ ì˜¤ë¥˜

```java
.leftJoin(todo.managers, manager)
.leftJoin(todo.comments, comment)
```

`todo` ì—”í‹°í‹°ì—ì„œ ë§¤ë‹ˆì €ë¥¼ ì¡°íšŒí•  ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

```
Ambiguous unqualified attribute reference 'user' (qualify the attribute reference by an identification variable)
```

`todo`ì™€ `manager`ê°€ ëª¨ë‘ `user`ë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´ ì–´ë–¤ userì¸ì§€ ëª…í™•í•˜ì§€ ì•Šì•„ì„œ ìƒê¸°ëŠ” ë¬¸ì œì˜€ë‹¤.

ë”°ë¼ì„œ í™•ì‹¤í•˜ê²Œ `manager`ë¼ê³  ëª…ì‹œë¥¼ í•´ì£¼ì—ˆë‹¤.

```java
.leftJoin(todo.managers, manager) 
.leftJoin(manager.user, user) 
.leftJoin(todo.comments, comment)
```

### QueryDSLì—ì„œ ë§¤ë‹ˆì € ìˆ˜ ì¡°íšŒ ì‹œ ì˜¤ë¥˜

ë§¤ë‹ˆì € ìˆ˜ì™€ ëŒ“ê¸€ ìˆ˜ë¥¼ ì¡°íšŒí•˜ë ¤ê³  ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆì„ ë•Œ

```java
.leftJoin(todo.managers, manager)
.leftJoin(todo.comments, comment)
.select(
    todo.title,
    manager.id.count(),
    comment.id.count()
)
.groupBy(todo.id)
```

ë§¤ë‹ˆì € ìˆ˜ì™€ ëŒ“ê¸€ ìˆ˜ê°€ ê³±í•´ì ¸ì„œ ë‚˜ì˜¤ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

<img width="360" alt="Image" src="https://github.com/user-attachments/assets/399a4b58-6b14-4d9c-8938-f7a67a28b9a5" />

ì¤‘ë³µì„ ì œê±°í•˜ê¸° ìœ„í•´ `countDistinct()`ë¥¼ ì‚¬ìš©í–ˆë‹¤.

```java
.select(new QTodoSearchResponse(
    todo.title,
    manager.id.countDistinct(),
    comment.id.countDistinct()
))
```
