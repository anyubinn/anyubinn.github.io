---
title: "[TIL] DAY43 Proxy, ì—°ê´€ê´€ê³„ ì£¼ì¸, Cascade, ê³ ì•„ ê°ì²´, íŠ¸ëœì­ì…˜ ì „íŒŒ"
categories: [ë‚´ì¼ë°°ì›€ìº í”„, TIL]
tag: [ê°œì¸ ê³¼ì œ, ë³¸ìº í”„, JPA, ì§€ì—°ë¡œë”©, Proxy, Cascade, ê³ ì•„ ê°ì²´, íŠ¸ëœì­ì…˜ ì „íŒŒ]
date: 2025-04-17 14:10:00 +0900
toc_sticky: true
---
## ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
***
### Proxy
JPAì—ì„œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” ë³´í†µ `em.find()`ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, **ì§€ì—° ë¡œë”©(Lazy Loading)**ì„ í™œìš©í•˜ê¸° ìœ„í•´ `em.getReference()`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë„ ë§ë‹¤. ì´ ë©”ì„œë“œëŠ” ì‹¤ì œ ì—”í‹°í‹° ëŒ€ì‹  **í”„ë¡ì‹œ ê°ì²´(proxy)**ë¥¼ ë°˜í™˜í•˜ë©°, **ì‹¤ì œ DB ì¡°íšŒë¥¼ ì§€ì—°**ì‹œì¼œ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

#### ğŸ” ì—”í‹°í‹° êµ¬ì„±

```java
@Entity
@Table(name = "tutor")
public class Tutor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToOne
    @JoinColumn(name = "company_id")
    private Company company;

    public Tutor() {}
    public Tutor(String name) {
        this.name = name;
    }

    // Getter/Setter ìƒëµ
}
```
```java
@Entity
@Table(name = "company")
public class Company {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    public Company() {}
    public Company(String name) {
        this.name = name;
    }

    // Getter ìƒëµ
}
```

***
#### âœ… `em.find()`ì™€ `em.getReference()` ì°¨ì´ì 
##### `em.find()`
- **ì¦‰ì‹œ ì‹¤ì œ DBì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒ**í•˜ì—¬ ì—”í‹°í‹° ê°ì²´ë¥¼ ë°˜í™˜
- ì¦‰ì‹œ ì¡°íšŒê°€ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©

```java
Tutor findTutor = em.find(Tutor.class, 1L);
System.out.println(findTutor.getName());  // ë°”ë¡œ SQL ì‹¤í–‰ë¨
```

##### `em.getReference()`
- ì‹¤ì œ DB ì¡°íšŒ ì—†ì´ **í”„ë¡ì‹œ ê°ì²´(ê°€ì§œ ê°ì²´)**ë¥¼ ë°˜í™˜
- **ì†ì„±ì— ì ‘ê·¼í•˜ëŠ” ìˆœê°„ DBì—ì„œ ì¡°íšŒ**

```java
Tutor proxyTutor = em.getReference(Tutor.class, 1L);
System.out.println(proxyTutor.getName());  // ì´ë•Œ SQL ì‹¤í–‰ë¨
```

***
#### ğŸ“¦ í”„ë¡ì‹œ ë™ì‘ ì›ë¦¬
![image](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F85163565-70f7-40ed-baee-c8168ec7db89%2Fimage.png?table=block&id=2bff4599-8f95-4f42-9f42-681d5c3e6048&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)
1. `em.getReference()` í˜¸ì¶œ
2. Hibernateê°€ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ì€ í”„ë¡ì‹œ ê°ì²´ ìƒì„±
3. í”„ë¡ì‹œ ë‚´ë¶€ì—ëŠ” `target`(ì§„ì§œ ê°ì²´) ì°¸ì¡°ë¥¼ ìœ„í•œ ë¡œì§ í¬í•¨
4. ì†ì„± ì ‘ê·¼ ì‹œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í†µí•´ DBì—ì„œ ì‹¤ì œ ë°ì´í„° ì¡°íšŒ
5. ì¡°íšŒëœ ë°ì´í„°ë¡œ ì§„ì§œ ê°ì²´ë¥¼ ì´ˆê¸°í™”

***
#### âš ï¸ í”„ë¡ì‹œ ê°ì²´ ì£¼ì˜ì‚¬í•­
- `==` ë¹„êµëŠ” ì‹¤íŒ¨ â†’ ëŒ€ì‹  `instanceof` ì‚¬ìš©
- ìµœì´ˆ í•œ ë²ˆ ì ‘ê·¼ ì‹œì—ë§Œ ì´ˆê¸°í™”ë¨
- `em.getReference()` í˜¸ì¶œ ì‹œ ì´ë¯¸ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ë©´ í”„ë¡ì‹œê°€ ì•„ë‹Œ ì‹¤ì œ ê°ì²´ê°€ ë°˜í™˜ë¨

##### âŒ LazyInitializationException

```java
Tutor proxyTutor = em.getReference(Tutor.class, 1L);
em.detach(proxyTutor);
proxyTutor.getName();  // âŒ LazyInitializationException ë°œìƒ!
```

- í”„ë¡ì‹œ ê°ì²´ëŠ” **ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ í•„ìš”**
- `detach()`ë¡œ ì¤€ì˜ì† ìƒíƒœê°€ ë˜ë©´ ì´ˆê¸°í™” ë¶ˆê°€ëŠ¥

***
### ì§€ì—°ë¡œë”©, ì¦‰ì‹œë¡œë”©
#### ğŸ¢ Lazy Loading (ì§€ì—° ë¡œë”©)
> ğŸ’¡ í•„ìš”í•œ ì‹œì ì— ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹<br>
> ì‹¤ì œ ì‚¬ìš©ë  ë•Œ DB ì¡°íšŒ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨

##### âœ… íŠ¹ì§•
- `@ManyToOne(fetch = FetchType.LAZY)`ì™€ ê°™ì´ `fetch` ì†ì„±ìœ¼ë¡œ ì„¤ì •
- ì—°ê´€ ê°ì²´ëŠ” **Proxy ê°ì²´**ë¡œ ì¡°íšŒë¨
- ê°ì²´ ì‚¬ìš© ì‹œì ì— SQL ì‹¤í–‰
- ìì£¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì—°ê´€ ê°ì²´ì— ì í•©

***
#### ğŸ“Œ ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "tutor")
public class Tutor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "company_id")
    private Company company;

    // ... ìƒì„±ì, getter, setter ìƒëµ
}
```
```java
Tutor findTutor = em.find(Tutor.class, tutor.getId());

System.out.println("findTutor.getCompany().getClass() = " + findTutor.getCompany().getClass()); 
// => Proxy ê°ì²´

System.out.println("findTutor.getCompany().getName() = " + findTutor.getCompany().getName()); 
// => ì´ ì‹œì ì— ì‹¤ì œ DB ì¡°íšŒ ì¿¼ë¦¬ ì‹¤í–‰
```

##### ğŸ“Œ ê²°ê³¼
- ì²˜ìŒì—” `Tutor`ë§Œ ì¡°íšŒë¨
- ì‹¤ì œ `Company` ì •ë³´ë¥¼ ì‚¬ìš©í•  ë•Œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨

***
#### ğŸ‡ Eager Loading (ì¦‰ì‹œ ë¡œë”©)
> ğŸ’¡ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ ë°ì´í„°ê¹Œì§€ í•œ ë²ˆì— ëª¨ë‘ ë¡œë“œí•˜ëŠ” ë°©ì‹<br>
> ì¡°íšŒ ì‹œ ë°”ë¡œ JOIN ì¿¼ë¦¬ê°€ ì‹¤í–‰ë¨

##### âœ… íŠ¹ì§•
- `@ManyToOne(fetch = FetchType.EAGER)`ì™€ ê°™ì´ ì„¤ì •
- **Proxy ì—†ì´** ì§„ì§œ ê°ì²´ë¥¼ ë°”ë¡œ ì¡°íšŒ
- ì—°ê´€ ê°ì²´ë¥¼ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ìœ ë¦¬
- ì˜ë„ì¹˜ ì•Šì€ **JOIN ì¿¼ë¦¬ í­íƒ„**ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ

***
#### ğŸ“Œ ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "tutor")
public class Tutor {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "company_id")
    private Company company;

    // ... ìƒì„±ì, getter, setter ìƒëµ
}
```
```java
Tutor findTutor = em.find(Tutor.class, tutor.getId());

System.out.println("findTutor.getCompany().getClass() = " + findTutor.getCompany().getClass());
// => ì‹¤ì œ Company ê°ì²´

System.out.println("findTutor.getCompany().getName() = " + findTutor.getCompany().getName());
// => ì´ë¯¸ í•œ ë²ˆì— ì¡°íšŒëê¸° ë•Œë¬¸ì— ë³„ë„ ì¿¼ë¦¬ ì—†ìŒ
```

##### ğŸ“Œ ê²°ê³¼
- `Tutor`ë¥¼ ì¡°íšŒí•  ë•Œ `Company`ë„ í•¨ê»˜ ì¡°íšŒ (JOIN)

***
#### âš ï¸ ì¦‰ì‹œ ë¡œë”© ì£¼ì˜ì 
##### ğŸ“ ê°œë°œìê°€ ì˜ë„í•˜ì§€ ì•Šì€ JOIN ë°œìƒ

```java
select t.*, c.* 
from tutor t 
left outer join company c on t.company_id = c.id
```

- ì¦‰ì‹œ ë¡œë”©ì€ ë‚´ë¶€ì ìœ¼ë¡œ í•­ìƒ JOINì„ ìˆ˜í–‰
- **ëª¨ë“  ì—°ê´€ëœ ê°ì²´ë¥¼ í•œ ë²ˆì— ì¡°íšŒ**í•¨

***
##### ğŸ“ N+1 ë¬¸ì œ ë°œìƒ ê°€ëŠ¥ì„±
```java
List<Tutor> tutorList = em.createQuery("select t from Tutor t", Tutor.class).getResultList();
```

**ğŸ“Œ ê²°ê³¼**
- `Tutor` ì¡°íšŒ: 1ë²ˆ
- ê°ê°ì˜ `Company` ì¡°íšŒ: Në²ˆ

ì´ **N+1ë²ˆì˜ SQL ì¿¼ë¦¬**ê°€ ë°œìƒ

#### ğŸ› ï¸ N+1 ë¬¸ì œ í•´ê²° ë°©ë²•
- Fetch Join

```java
List<Tutor> tutorList = em.createQuery(
    "select t from Tutor t join fetch t.company", Tutor.class
).getResultList();
```

- @EntityGraph
- @BatchSize
- Native Query

***
### ì˜ì†ì„± ì „ì´
#### ğŸŒŠ ì˜ì†ì„± ì „ì´(Cascade)ë€?
> íŠ¹ì • ì—”í‹°í‹°ì— ëŒ€í•œ ì‘ì—…(ì €ì¥, ì‚­ì œ ë“±)ì„ ìˆ˜í–‰í•  ë•Œ, ì—°ê´€ëœ ì—”í‹°í‹°ì—ë„ ê°™ì€ ì‘ì—…ì„ ìë™ìœ¼ë¡œ ì „ì´ì‹œì¼œì£¼ëŠ” ê¸°ëŠ¥

- `Cascade`ëŠ” **ì—°ê´€ê´€ê³„ ì„¤ì •**ê³¼ëŠ” ì „í˜€ ë¬´ê´€
- **ì§€ì—° ë¡œë”©(Lazy)**, **ì¦‰ì‹œ ë¡œë”©(Eager)** ê³¼ë„ ë³„ê°œ 

***
##### âœ”ï¸ ì˜ˆì œ ì½”ë“œ (1:N ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„)

```java
@Entity
public class Category {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany(mappedBy = "category")
    private List<Product> productList = new ArrayList<>();

    public void addProduct(Product product) {
        productList.add(product);
        product.setCategory(this);
    }
}
```
```java
@Entity
public class Product {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @ManyToOne
    @JoinColumn(name = "category_id")
    private Category category;

    public void setCategory(Category category) {
        this.category = category;
    }
}
```
```java
// ì˜ì†ì„± ì „ì´ ì—†ì´ persist
Category category = new Category("food");
Product product1 = new Product("pizza");
Product product2 = new Product("kimchi");

category.addProduct(product1);
category.addProduct(product2);

em.persist(category); 
em.persist(product1);
em.persist(product2); // ì´ 3ë²ˆ persist í˜¸ì¶œ í•„ìš”
```

***
##### âœ”ï¸ ì˜ˆì œ ì½”ë“œ (1:N ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„)

```java
@OneToMany(mappedBy = "category", cascade = CascadeType.ALL)
private List<Product> productList = new ArrayList<>();
```
```java
// ì˜ì†ì„± ì „ì´ ì ìš©
Category category = new Category("food");
Product product1 = new Product("pizza");
Product product2 = new Product("kimchi");

category.addProduct(product1);
category.addProduct(product2);

em.persist(category); // ë‹¨ í•œ ë²ˆì˜ persistë¡œ ì—°ê´€ëœ Productë„ í•¨ê»˜ ì €ì¥ë¨
```

***
#### ğŸ“‹ Cascade ì¢…ë¥˜

| íƒ€ì…                | ì„¤ëª…                            |
|---------------------|---------------------------------|
| `ALL`               | ëª¨ë“  Cascade ë™ì‘ ì ìš©          |
| `PERSIST`           | ì˜ì† ìƒíƒœ ì „ì´                  |
| `REMOVE`            | ì‚­ì œ ì „ì´                       |
| `MERGE`             | ë³‘í•© ì „ì´                       |
| `REFRESH`, `DETACH` | ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ                |

***
#### ğŸ’¡ ì–¸ì œ ì‚¬ìš©í• ê¹Œ?
- ìì‹ ì—”í‹°í‹°ê°€ ë¶€ëª¨ ì—”í‹°í‹°ì— **ì™„ì „íˆ ì¢…ì†ì ì¼ ë•Œë§Œ** ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ

##### âœ… ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ
- ê²Œì‹œê¸€ â†” ëŒ“ê¸€
- ìƒí’ˆ â†” ìƒí’ˆ ì´ë¯¸ì§€

##### âŒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì˜ˆì‹œ
- ì‘ê°€ â†” ì±…
  â†’ ì‘ê°€ê°€ ì‚­ì œë˜ì–´ë„ ì±…ì€ ë‚¨ì•„ìˆì–´ì•¼ í•˜ë¯€ë¡œ ìƒëª…ì£¼ê¸°ê°€ ë‹¤ë¦„

***
#### ğŸ‘¶ ê³ ì•„ ê°ì²´(orphanRemoval)
> ë¶€ëª¨ì™€ì˜ ì—°ê´€ê´€ê³„ê°€ ëŠê¸´ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•´ì£¼ëŠ” ê¸°ëŠ¥

```java
@OneToMany(mappedBy = "category", cascade = CascadeType.ALL, orphanRemoval = true)
private List<Product> productList = new ArrayList<>();
```

##### âœ… ì˜ˆì œ ì½”ë“œ

```java
// ì—”í‹°í‹° ì €ì¥
Category category = new Category("food");
Product product1 = new Product("pizza");
Product product2 = new Product("kimchi");

category.addProduct(product1);
category.addProduct(product2);

em.persist(category);
em.flush();
em.clear();

// ì—°ê´€ê´€ê³„ ì œê±°
Category findCategory = em.find(Category.class, category.getId());
findCategory.getProductList().remove(0); // ê³ ì•„ ê°ì²´ ë°œìƒ
```

> ğŸ‘‰ `orphanRemoval = true` ì„¤ì • ë•ë¶„ì—, ë¦¬ìŠ¤íŠ¸ì—ì„œ ì œê±°ëœ `product1`ì€ **ìë™ìœ¼ë¡œ DBì—ì„œ ì‚­ì œ**ë¨

***
#### âš ï¸ ì£¼ì˜ì‚¬í•­
- **ì°¸ì¡°í•˜ëŠ” ê³³ì´ í•˜ë‚˜ë¿ì¼ ë•Œë§Œ ì‚¬ìš©**
- `@OneToOne`, `@OneToMany` ê´€ê³„ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
- `orphanRemoval = true`ëŠ” `CascadeType.REMOVE`ì™€ ë¹„ìŠ·í•˜ê²Œ ë™ì‘í•˜ì§€ë§Œ **ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì¡Œì„ ë•Œë§Œ ì‚­ì œí•¨**

***
#### ğŸ§© Cascade vs OrphanRemoval

| êµ¬ë¶„           | ì„¤ëª…                                 | ì‚¬ìš© ëª©ì                |
|----------------|--------------------------------------|--------------------------|
| `Cascade`      | ë¶€ëª¨ ì‘ì—…ì´ ìì‹ì—ê²Œ ì „ì´            | ì €ì¥, ì‚­ì œ ì „ì´          |
| `orphanRemoval`| ë¶€ëª¨ì™€ ê´€ê³„ê°€ ëŠê¸´ ìì‹ ì‚­ì œ         | ê³ ì•„ ê°ì²´ ìë™ ì‚­ì œ      |

> âœ¨ ë‘ ê¸°ëŠ¥ì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë¶€ëª¨ ì—”í‹°í‹°ê°€ ìì‹ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ì™„ì „íˆ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ **ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)**ì— ì í•©í•¨<br>
> ìì‹ì€ ë³„ë„ì˜ Repository ì—†ì´ë„ ê´€ë¦¬ê°€ ê°€ëŠ¥

***
### JPAì™€ Transaction
#### ğŸ’¡ íŠ¸ëœì­ì…˜ ì „íŒŒë€?
> í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì–´ë–»ê²Œ ë™ì‘í• ì§€ë¥¼ ê²°ì •í•˜ëŠ” ê·œì¹™

- ì—¬ëŸ¬ ê³„ì¸µ(ë˜ëŠ” ë©”ì„œë“œ)ì—ì„œ íŠ¸ëœì­ì…˜ì´ ì–´ë–»ê²Œ ì „ë‹¬ë˜ê³  ë™ì‘í• ì§€ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŒ
- `@Transactional` ì• ë„ˆí…Œì´ì…˜ì˜ `propagation` ì†ì„±ì„ í†µí•´ ì§€ì •
- ì„œë¡œ ë‹¤ë¥¸ í´ë˜ìŠ¤ ê°„ íŠ¸ëœì­ì…˜ì˜ íë¦„ì„ êµí†µì •ë¦¬í•˜ëŠ” ì—­í• ì„ í•¨

***
#### ğŸ§¬ íŠ¸ëœì­ì…˜ ì „íŒŒì˜ í•µì‹¬ ê°œë…
- í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë‚˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ê°ê° íŠ¸ëœì­ì…˜ì´ ì–´ë–»ê²Œ ì ìš©ë ì§€ë¥¼ ì •í•¨
- íŠ¸ëœì­ì…˜ íë¦„ì„ ìœ ì—°í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆì–´ **ë³µì¡í•œ ìš”êµ¬ì‚¬í•­**ì´ë‚˜ **ì—ëŸ¬ì²˜ë¦¬**ì— ìœ ìš©í•¨
- ì„¤ì •ì„ í†µí•´ **ë¡¤ë°± ë²”ìœ„**, **ì»¤ë°‹ ì‹œì ** ë“±ì„ ì œì–´í•  ìˆ˜ ìˆìŒ

***
#### ğŸ§ª ì˜ˆì œ: ê¸°ë³¸ ì „íŒŒ(`REQUIRED`)

```java
@Service
@RequiredArgsConstructor
public class MemberService {

    private final PointPolicy pointPolicy;

    @Transactional
    public void signUp(Member member) {
        memberRepository.save(member); // íšŒì› ë“±ë¡
        pointPolicy.addPoints(member.getId(), 100); // í¬ì¸íŠ¸ ì§€ê¸‰
    }
}
```
```java
@Component
public class PointPolicy {
    public void addPoints(Long memberId, int points) {
        pointRepository.save(new Point(memberId, points));
    }
}
```

##### ğŸ” ì„¤ëª…
- `signUp()` ë©”ì„œë“œì— `@Transactional`ì´ ë¶™ì–´ ìˆê³ , `addPoints()`ëŠ” ë³„ë„ì˜ íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰ë¨
- ì´ ê²½ìš° `addPoints()`ëŠ” **ìƒìœ„ íŠ¸ëœì­ì…˜ì„ ê·¸ëŒ€ë¡œ ì „íŒŒ**ë°›ìŒ (default = `REQUIRED`)
- í•˜ìœ„ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì „ì²´ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë¨

***
#### âš™ï¸ ì „íŒŒ ì˜µì…˜ ì¢…ë¥˜ (Propagation)

| ì˜µì…˜            | ì„¤ëª…                                                                 |
|-----------------|----------------------------------------------------------------------|
| `REQUIRED`      | ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„± (ê¸°ë³¸ê°’)               |
| `REQUIRES_NEW`  | í•­ìƒ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±, ê¸°ì¡´ íŠ¸ëœì­ì…˜ì€ ì¼ì‹œ ì¤‘ë‹¨              |
| `SUPPORTS`      | ê¸°ì¡´ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰              |
| `NOT_SUPPORTED` | íŠ¸ëœì­ì…˜ ì—†ì´ ì‹¤í–‰ (ê¸°ì¡´ íŠ¸ëœì­ì…˜ì€ ì¤‘ë‹¨)                            |
| `MANDATORY`     | ë°˜ë“œì‹œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼ í•¨ (ì—†ìœ¼ë©´ ì˜ˆì™¸ ë°œìƒ)              |
| `NEVER`         | íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ë©´ ì˜ˆì™¸ ë°œìƒ                                        |
| `NESTED`        | ì¤‘ì²© íŠ¸ëœì­ì…˜ ìƒì„± (ë…ë¦½ì ìœ¼ë¡œ ë¡¤ë°± ê°€ëŠ¥)                           |

***
#### ğŸ§ª ì˜ˆì œ: ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•œ ê²½ìš° (`REQUIRES_NEW`)

```java
@Service
@RequiredArgsConstructor
public class MemberService {

    private final PointPolicy pointPolicy;

    @Transactional
    public void signUp(Member member) {
        memberRepository.save(member); // íšŒì› ë“±ë¡
        pointPolicy.addPoints(member.getId(), 100); // í¬ì¸íŠ¸ ì§€ê¸‰
    }
}
```
```java
@Component
public class PointPolicy {

    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void addPoints(Long memberId, int points) {
        pointRepository.save(new Point(memberId, points)); // í¬ì¸íŠ¸ ì§€ê¸‰
    }
}
```

##### âœ… ì‚¬ìš© ì‹œì 
> ìš”êµ¬ì‚¬í•­: í¬ì¸íŠ¸ ì§€ê¸‰ì— ì‹¤íŒ¨í•´ë„ íšŒì› ê°€ì…ì€ ì„±ê³µí•´ì•¼ í•œë‹¤

- `REQUIRES_NEW`ëŠ” í•­ìƒ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•˜ë¯€ë¡œ `signUp()`ê³¼ëŠ” **ë³„ë„ì˜ íŠ¸ëœì­ì…˜**ìœ¼ë¡œ ë™ì‘í•¨
- í¬ì¸íŠ¸ ì§€ê¸‰ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ë„ íšŒì› ë“±ë¡ì€ **ë¡¤ë°±ë˜ì§€ ì•ŠìŒ**
- íŠ¸ëœì­ì…˜ ê°„ì— **ì™„ì „íˆ ë¶„ë¦¬ëœ ìƒëª…ì£¼ê¸°**ë¥¼ ê°–ê²Œ ë¨
