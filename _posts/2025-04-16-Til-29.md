---
title: "[TIL] DAY42 JPA ì—°ê´€ê´€ê³„ ë§¤í•‘"
categories: [ë‚´ì¼ë°°ì›€ìº í”„, TIL]
tag: [ê°œì¸ ê³¼ì œ, ë³¸ìº í”„, JPA, ì—°ê´€ê´€ê³„ ë§¤í•‘, Java, Spring Boot, Entity]
date: 2025-04-16 15:10:00 +0900
toc_sticky: true
---
## ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
***
### 1:N ì—°ê´€ê´€ê³„
JPAì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ **ì—°ê´€ê´€ê³„ ë§¤í•‘** ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ì´ë¥¼ í†µí•´ SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³ ë„ ê°ì²´ ê°„ì˜ ê´€ê³„ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆë‹¤.

#### ğŸ“Œ ì—°ê´€ê´€ê³„ ë§¤í•‘ ê°œìš”
- ì¢…ë¥˜: `N:1`, `1:N`, `1:1`, `N:M`
- ë°©í–¥: ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸: ì™¸ë˜ í‚¤(FK)ë¥¼ ê°€ì§„ ìª½ (ìˆ˜ì •ê¶Œí•œ ë³´ìœ )

> DBëŠ” ì™¸ë˜ í‚¤ë§Œìœ¼ë¡œ ììœ ë¡­ê²Œ JOINì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ê°ì²´ëŠ” ì°¸ì¡°ë¥¼ í†µí•œ ì ‘ê·¼ë§Œ ê°€ëŠ¥í•˜ë¯€ë¡œ ë°©í–¥ì„±ì„ ê³ ë ¤í•´ì•¼ í•¨

***
#### ğŸ” 1:N ë‹¨ë°©í–¥ ë§¤í•‘
##### ğŸ’¡ ê°œë…
- í•œ ì—”í‹°í‹°ê°€ ì—¬ëŸ¬ ì—”í‹°í‹°ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì°¸ì¡°í•¨
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ `1`ìª½ì´ì§€ë§Œ, ì‹¤ì œ ì™¸ë˜ í‚¤ëŠ” `N` í…Œì´ë¸”ì— ìˆì–´ ì¶”ê°€ì ì¸ UPDATEê°€ ë°œìƒí•¨

##### âœ… ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
public class Company {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany
    @JoinColumn(name = "company_id") // ì™¸ë˜ í‚¤ ì§€ì •
    private List<Tutor> tutors = new ArrayList<>();
}
```
```java
@Entity
public class Tutor {
    @Id @GeneratedValue
    private Long id;
    private String name;
}
```

##### âš ï¸ ë‹¨ì 
- DBëŠ” ì™¸ë˜ í‚¤ë¥¼ `N` í…Œì´ë¸”ì— ì„¤ì •í•´ì•¼ í•˜ë¯€ë¡œ `Company`ê°€ `Tutor`ì˜ ì™¸ë˜ í‚¤ë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ **ì¶”ê°€ì ì€ UPDATE ì¿¼ë¦¬**ê°€ ë°œìƒ
- `@JoinColumn`ì„ ìƒëµí•˜ë©´ **ì¤‘ê°„ í…Œì´ë¸”** ë°©ì‹ì´ ë˜ì–´ ì˜ë„ì™€ ë‹¤ë¥¸ ë§¤í•‘ì´ ìƒì„±ë¨

> ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ì„±ëŠ¥ì„ ê³ ë ¤í•˜ë©´ `N:1 ì–‘ë°©í–¥` ë§¤í•‘ì´ ë” ì í•©í•¨

***
#### ğŸ”„ 1:N ì–‘ë°©í–¥ ë§¤í•‘
##### ğŸ’¡ ê°œë…
- `Company`ê°€ `Tutor`ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ, `Tutor`ëŠ” `Company`ë¥¼ ë‹¨ì¼ ê°ì²´ë¡œ ì°¸ì¡°í•¨
- ë‹¨, ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ `Tutor`

##### âœ… ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
public class Tutor {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @ManyToOne
    @JoinColumn(name = "company_id", insertable = false, updatable = false) // ì½ê¸° ì „ìš©
    private Company company;
}
```

> `insertable=false`, `updatable=false` ì˜µì…˜ì„ ì£¼ì–´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì•„ë‹˜ì„ ëª…í™•íˆ í•¨

***
### 1:1 ì—°ê´€ê´€ê³„
#### ğŸ“Œ 1:1 ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

> ë‘ ì—”í‹°í‹°ê°€ `@OneToOne`ì„ í†µí•´ ì—°ê´€ì„ ë§ºë˜, í•œìª½ë§Œ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°

##### ğŸ’¡ ê°œë…
- ì™¸ë˜ í‚¤ì˜ ì£¼ì¸ì€ `Tutor`ë¡œ ì„¤ì •
- ì™¸ë˜ í‚¤ì— `UNIQUE` ì œì•½ì¡°ê±´ í•„ìˆ˜

##### âœ… ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "address")
public class Address {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
}
```
```java
@Entity
@Table(name = "tutor")
public class Tutor {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToOne
  @JoinColumn(name = "address_id", unique = true)
  private Address address;

}
```

> ğŸ“Œ ë‹¨ë°©í–¥ì¼ ê²½ìš°, ì™¸ë˜ í‚¤ê°€ ìˆëŠ” `Tutor`ë§Œ `Address`ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ

***
#### ğŸ“Œ 1:1 ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

> ì–‘ìª½ ì—”í‹°í‹°ê°€ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°<br>
> ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

##### âœ… ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "address")
public class Address {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;

    @OneToOne(mappedBy = "address")
    private Tutor tutor;

}
```
```java
@Entity
@Table(name = "tutor")
public class Tutor {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String name;

  @OneToOne
  @JoinColumn(name = "address_id", unique = true)
  private Address address;

}
```

> ğŸ“Œ `Address` ì…ì¥ì—ì„œëŠ” ì½ê¸° ì „ìš© í•„ë“œë¡œ ì‘ë™

***
#### âš–ï¸ ì™¸ë˜ í‚¤ ìœ„ì¹˜ì— ë”°ë¥¸ ì„¤ê³„ ì „ëµ

> 1:1 ì—°ê´€ê´€ê³„ì—ì„œëŠ” ì™¸ë˜ í‚¤ë¥¼ ì–´ëŠ í…Œì´ë¸”ì— ë‘˜ì§€ ì„ íƒí•  ìˆ˜ ìˆìŒ

##### ğŸ“Œ ì˜ˆì‹œ: `Tutor`ê°€ `Address`ë¥¼ ê°€ì§
- ì™¸ë˜ í‚¤ë¥¼ `Tutor`ê°€ ê°€ì§€ê³  ìˆë‹¤ë©´
  - ë‹¨ë°©í–¥ ë˜ëŠ” ì–‘ë°©í–¥ ì„¤ì • ê°€ëŠ¥
  - `Tutor`ì—ì„œ `Address`ë¥¼ ì‰½ê²Œ ì¡°íšŒ ê°€ëŠ¥
- ì™¸ë˜ í‚¤ë¥¼ `Address`ê°€ ê°€ì§€ê³  ìˆë‹¤ë©´
  - `Tutor`ì—ì„œ ì ‘ê·¼ì´ ì–´ë ¤ì›€(ì½ê¸° ì „ìš©)
  - ë¬´ê²°ì„±ì€ ë” ì˜ ë³´ì¥ë¨

***
##### ğŸ”„ ìš”êµ¬ì‚¬í•­ ë³€ê²½ ëŒ€ì‘

> ì˜ˆ: `Tutor`ê°€ ì—¬ëŸ¬ ê°œì˜ `Address`ë¥¼ ê°€ì§€ëŠ” ê²½ìš°

**ê¸°ì¡´ êµ¬ì¡°**
![image](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Fc7b23557-e6f0-403e-be65-d3fa814147ef%2Fimage.png?table=block&id=291c183d-cb6e-4372-a33a-3218adce74ae&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

**ë³€ê²½ í›„ êµ¬ì¡°**
![image](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F4542ee6a-b20e-4fbc-87ef-183179447376%2Fimage.png?table=block&id=e6b7aad1-a70b-43dc-a952-4887dd9da93c&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=580&userId=&cache=v2)

- `UNIQUE` ì œì•½ì¡°ê±´ì„ ì œê±°í•˜ë©´ ìì—°ìŠ¤ëŸ½ê²Œ `1:N`ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥
- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¡œ ì„¤ì •í•´ì•¼ í™œìš©ë„ê°€ ë†’ì•„ì§

***
#### ğŸ“Š ì™¸ë˜ í‚¤ ìœ„ì¹˜ì˜ ì¥ë‹¨ì 

| êµ¬ë¶„                   | ì£¼ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤                                | ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤                             |
|------------------------|----------------------------------------------------|---------------------------------------------------|
| ì¥ì                    | JPA í™œìš©ì´ ì‰¬ì›€, ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ ìš©ì´            | ë¬´ê²°ì„± ë³´ì¥, êµ¬ì¡° ë³€ê²½ì— ìœ ì—°                     |
| ë‹¨ì                    | `null` í—ˆìš©, ì‚­ì œ ì‹œ ì²˜ë¦¬ ë³µì¡                    | ì¦‰ì‹œ ë¡œë”© ê°•ì œ, ë§¤í•‘ ë³µì¡, ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥         |

***
### N:M ì—°ê´€ê´€ê³„
JPAì—ì„œëŠ” `@ManyToMany`ë¥¼ í†µí•´ ë‘ ì—”í‹°í‹° ê°„ì˜ N:M(ë‹¤ëŒ€ë‹¤) ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œ ê°œë°œì—ì„œëŠ” ì¤‘ê°„ í…Œì´ë¸”ì„ ëª…ì‹œì ìœ¼ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ì´ ë” ìœ ì—°í•˜ê³  ì‹¤ìš©ì ì´ë‹¤.

***
#### ğŸ“Œ N:M ì—°ê´€ê´€ê³„ë€?

> ë‘ ì—”í‹°í‹°ê°€ ì„œë¡œ ì—¬ëŸ¬ ê°œì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°

- ì—¬ëŸ¬ ëª…ì˜ **íŠœí„°**ê°€ ì—¬ëŸ¬ ê°œì˜ **í”„ë¡œê·¸ë˜ë° ì–¸ì–´**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- ê°ì²´ êµ¬ì¡°ì—ì„œëŠ” ì»¬ë™ì…˜ì„ í†µí•´ ë‹¨ìˆœíˆ í‘œí˜„í•  ìˆ˜ ìˆìŒ
- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” `ì¤‘ê°„ í…Œì´ë¸”`ì„ í†µí•´ `1:N`, `N:1` ê´€ê³„ë¡œ í’€ì–´ë‚´ì•¼ í•¨

***
#### âœ… N:M ë‹¨ë°©í–¥ ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "language")
public class Language {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
}
```
```java
@Entity
@Table(name = "tutor")
public class Tutor {
  @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;
  private String name;

  @ManyToMany
  @JoinTable(
    name = "tutor_language",
    joinColumns = @JoinColumn(name = "tutor_id"),
    inverseJoinColumns = @JoinColumn(name = "language_id")
  )
  private List<Language> languages = new ArrayList<>();
}
```

> ğŸ“Œ ë‹¨ë°©í–¥ìœ¼ë¡œë§Œ ì„¤ì •ëœ ê²½ìš°, `Tutor`ë§Œ `Language`ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŒ

***
#### âœ… N:M ì–‘ë°©í–¥ ì½”ë“œ ì˜ˆì‹œ

```java
@Entity
@Table(name = "language")
public class Language {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @ManyToMany(mappedBy = "languages")
    private List<Tutor> tutors = new ArrayList<>();
}
```

- `mappedBy`ë¥¼ í†µí•´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •
- ë‚´ë¶€ì ìœ¼ë¡œëŠ” `tutor_language`ë¼ëŠ” **ì¤‘ê°„ í…Œì´ë¸”**ì´ ìë™ìœ¼ë¡œ ìƒì„±ë¨

***
#### âš ï¸ @ManyToManyì˜ ë¬¸ì œì 
![image](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2Fd425a4e9-607c-4014-87e6-0be41d472608%2Fimage.png?table=block&id=eca2bc88-8b03-44d4-9994-5a048786df1b&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=770&userId=&cache=v2)
- ì¤‘ê°„ í…Œì´ë¸”ì— **ì¶”ê°€ ì»¬ëŸ¼(level, license ë“±)**ì„ ë„£ì„ ìˆ˜ ì—†ìŒ
- SQL ì¿¼ë¦¬ê°€ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ì›Œì§
- ì¤‘ê°„ í…Œì´ë¸”ì˜ PKê°€ ë³µí•©í‚¤(`tutor_id`, `language_id`)ë¡œ ì„¤ì •ë˜ì–´ ìœ ì—°ì„±ì´ ë–¨ì–´ì§

##### ğŸ’¡ ì¤‘ê°„ í…Œì´ë¸”ì„ ì—”í‹°í‹°ë¡œ ë¶„ë¦¬
![image](https://teamsparta.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F83c75a39-3aba-4ba4-a792-7aefe4b07895%2F63a3e756-7b01-4f20-ab09-17bf24cfb28f%2Fimage.png?table=block&id=a60fd640-e649-4f93-b25c-ea05b5e266b3&spaceId=83c75a39-3aba-4ba4-a792-7aefe4b07895&width=770&userId=&cache=v2)

> `@ManyToMany`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì¤‘ê°„ í…Œì´ë¸”ì„ ëª…ì‹œì ì¸ ì—”í‹°í‹°ë¡œ ë¶„ë¦¬

**ğŸ”§ ì¤‘ê°„ ì—”í‹°í‹°**

```java
@Entity
@Table(name = "tutor_language")
public class TutorLanguage {

    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "tutor_id")
    private Tutor tutor;

    @ManyToOne
    @JoinColumn(name = "language_id")
    private Language language;

    private Integer level;
    private String license;
}
```

**ğŸ§© ì–‘ìª½ ì—”í‹°í‹°ì—ì„œì˜ ë§¤í•‘**

```java
@Entity
@Table(name = "tutor")
public class Tutor {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "tutor")
    private List<TutorLanguage> tutorLanguages = new ArrayList<>();
}
```
```java
@Entity
@Table(name = "language")
public class Language {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "language")
    private List<TutorLanguage> tutorLanguages = new ArrayList<>();
}
```
