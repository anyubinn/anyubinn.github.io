---
title: "[TIL] DAY52 H2 ë°ì´í„°ë² ì´ìŠ¤, SQL ê¸°ë³¸ ë¬¸ë²•, JDBC, JdbcTemplate"
categories: [ë‚´ì¼ë°°ì›€ìº í”„, TIL]
tag: [ê°œì¸ ê³¼ì œ, ë³¸ìº í”„, SpringBoot, H2 Database, SQL, JDBC, JdbcTemplate, ë°ì´í„°ë² ì´ìŠ¤]
date: 2025-04-30 20:00:00 +0900
toc_sticky: true
---
## ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
***
### ğŸ’¿ H2 ë°ì´í„°ë² ì´ìŠ¤
#### ğŸ“Œ H2 ë°ì´í„°ë² ì´ìŠ¤ë€?
##### ğŸ”¹ ë‚´ì¥í˜• H2 DB
- **H2**ëŠ” Java ê¸°ë°˜ì˜ **ê²½ëŸ‰í˜• ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤**
- ê°œë°œê³¼ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì—ì„œ **ì„¤ì¹˜ ì—†ì´ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥**í•˜ë©°, ë©”ëª¨ë¦¬ ê¸°ë°˜ ë˜ëŠ” íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ìœ ì—°í•˜ê²Œ ì‘ë™
- `spring-boot-starter-data-jpa` ë˜ëŠ” `starter-jdbc` ì˜ì¡´ì„±ë§Œ ì¶”ê°€í•´ë„ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥

***
#### ğŸ“‹ H2 ì‚¬ìš© ë°©ì‹

| Mode             | ì„¤ì¹˜ í•„ìš” | ì‹¤í–‰ ì£¼ì²´   | ë°ì´í„° ì €ì¥ ìœ„ì¹˜       | ì‚¬ìš© ìš©ë„ |
|------------------|-----------|--------------|--------------------------|------------|
| Server Mode      | O         | ì™¸ë¶€ ì‹¤í–‰   | íŒŒì¼ ì‹œìŠ¤í…œ              | ìš´ì˜ìš© |
| In-Memory Mode   | X         | ì• í”Œë¦¬ì¼€ì´ì…˜ | ë©”ëª¨ë¦¬ (íœ˜ë°œì„±)          | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |
| Embedded Mode    | X         | ì• í”Œë¦¬ì¼€ì´ì…˜ | íŒŒì¼ ì‹œìŠ¤í…œ (ì§€ì†ì„± ìˆìŒ) | ê°œë°œìš© |

- `Server Mode`
  - MySQLì²˜ëŸ¼ DB ì—”ì§„ì„ ë”°ë¡œ ì‹¤í–‰
- `In-Memory Mode`
  - íœ˜ë°œì„±, í…ŒìŠ¤íŠ¸ìš©
- `Embedded Mode`
  - ë©”ëª¨ë¦¬ì—” ìˆì§€ë§Œ **íŒŒì¼ë¡œ ì˜ì†ì„± ìœ ì§€**, ê°œë°œí™˜ê²½ì— ìµœì 

***
#### ğŸŒ± Spring Bootì—ì„œ Embedded H2 ì„¤ì •

```yaml
# application.yml
spring:
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:~/test
    username: sa
    password:

  h2:
    console:
      enabled: true
```

- `~/test` â†’ ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ì— `test.mv.db` íŒŒì¼ ìƒì„±
- H2 ì½˜ì†” ì£¼ì†ŒëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `http://localhost:8080/h2-console`
- ì½˜ì†”ì—ì„œ JDBC URLì€ `jdbc:h2:~/test`ë¡œ ì…ë ¥

***
### âœï¸ SQL ê¸°ë³¸ ë¬¸ë²•
#### ğŸ“ DDL - í…Œì´ë¸” ì •ì˜

```sql
CREATE TABLE users (
  id SERIAL,
  name VARCHAR(255),
  email VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  status ENUM('active', 'inactive') DEFAULT 'active'
);
```

#### ğŸ“ DML - ë°ì´í„° ì¡°ì‘

```sql
-- INSERT
INSERT INTO users (name, email, status)
VALUES ('Alice', 'alice@example.com', 'active');

-- UPDATE
UPDATE users SET name = 'Alicia' WHERE id = 1;

-- SELECT
SELECT * FROM users WHERE status = 'active';

-- DELETE
DELETE FROM users WHERE id = 2;
```

#### ğŸ“ DCL - íŠ¸ëœì­ì…˜ ê´€ë¦¬

```sql
BEGIN;
UPDATE users SET status = 'inactive' WHERE id = 1;
ROLLBACK; -- or COMMIT;
```

#### ğŸ¯ íŠ¸ëœì­ì…˜ì˜ 3ëŒ€ íŠ¹ì§•
1. **ì›ìì„±**: ì‘ì—… ë‹¨ìœ„ëŠ” ì „ë¶€ ë°˜ì˜ë˜ê±°ë‚˜ ì „í˜€ ë°˜ì˜ë˜ì§€ ì•Šì•„ì•¼ í•¨
2. **ì¼ê´€ì„±**: ì‘ì—… ì „í›„ ìƒíƒœëŠ” í•­ìƒ ì¼ê´€ë˜ì–´ì•¼ í•¨
3. **ë…ë¦½ì„±**: íŠ¸ëœì­ì…˜ì€ ì„œë¡œ ê°„ì„­ë°›ì§€ ì•Šì•„ì•¼ í•¨

***
### ğŸª› ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° (Driver)
#### ğŸ“Œ ë°ì´í„°ë² ì´ìŠ¤ ë“œë¼ì´ë²„ë€?
- **JDBC ë“œë¼ì´ë²„**ëŠ” **Java ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì—ì„œ í†µì‹ ì„ ì¤‘ê°œ**í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´
- ê°œë°œìëŠ” SQLì„ ì‘ì„±í•˜ê³  ì‹¤í–‰í•˜ì§€ë§Œ, ì‹¤ì œë¡œëŠ” ë“œë¼ì´ë²„ê°€ ì´ë¥¼ **DBê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ë²ˆì—­**í•˜ì—¬ ì‹¤í–‰

#### ğŸ“¦ ë°ì´í„°ë² ì´ìŠ¤ë³„ ë“œë¼ì´ë²„ ì¢…ë¥˜

| DBMS ì¢…ë¥˜   | JDBC ë“œë¼ì´ë²„ í´ë˜ìŠ¤ ì˜ˆì‹œ                  |
|------------|---------------------------------------------|
| H2         | `org.h2.Driver`                            |
| MySQL      | `com.mysql.cj.jdbc.Driver`                 |
| PostgreSQL | `org.postgresql.Driver`                    |
| Oracle     | `oracle.jdbc.OracleDriver`                 |

***
#### âœˆï¸ ë“œë¼ì´ë²„ ë™ì‘ íë¦„
1. ì—°ê²° ìš”ì²­
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë“œë¼ì´ë²„ë¥¼ í†µí•´ DBì— ì—°ê²°ì„ ìš”ì²­í•¨
2. ì ‘ì† ì„¤ì •
- ë“œë¼ì´ë²„ëŠ” DB URL, ID/PW ê¸°ë°˜ìœ¼ë¡œ ì—°ê²° ì„¤ì • ìˆ˜í–‰
3. SQL ì‹¤í–‰
- ë“œë¼ì´ë²„ê°€ SQLì„ DB ì „ìš© ëª…ë ¹ìœ¼ë¡œ ë²ˆì—­ í›„ ì „ì†¡
4. ê²°ê³¼ ìˆ˜ì‹ 
- ì‹¤í–‰ ê²°ê³¼ë¥¼ ResultSet í˜•íƒœë¡œ ë°›ì•„ ë‹¤ì‹œ ìë°” ì½”ë“œë¡œ ì „ë‹¬
5. ì—°ê²° ì¢…ë£Œ
- ì‘ì—… ì¢…ë£Œ í›„ ìì›ì„ ì •ë¦¬í•˜ê³  DB ì—°ê²°ì„ ì¢…ë£Œ

***
#### ğŸ§© JDBC êµ¬ì¡°
| ê°ì²´        | ì—­í•  ì„¤ëª… |
|-------------|-----------|
| **Connection**  | DB ì—°ê²°ì„ ìƒì„±í•˜ê³  ìœ ì§€ |
| **Statement / PreparedStatement** | SQLì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„ |
| **ResultSet** | ì‹¤í–‰ ê²°ê³¼ë¥¼ í…Œì´ë¸” í˜•íƒœë¡œ ë°›ìŒ |

***
### ğŸ§ª JDBC ì‹¤ìŠµ
#### ğŸ”¸ JDBC ê¸°ë³¸ íë¦„
1. `Connection` íšë“
2. `PreparedStatement` ì‘ì„± ë° ì‹¤í–‰
3. `ResultSet`ìœ¼ë¡œ ê²°ê³¼ ì²˜ë¦¬
4. ìì› í•´ì œ

```java
String url = "jdbc:h2:mem:test";
Connection conn = DriverManager.getConnection(url, "sa", null);
```

#### ğŸ’¡ Statement vs PreparedStatement

| êµ¬ë¶„ | Statement | PreparedStatement |
|------|-----------|-------------------|
| ë³´ì•ˆì„± | ë‚®ìŒ (SQL Injection ìœ„í—˜) | ë†’ìŒ |
| ì„±ëŠ¥ | ë°˜ë³µ ì‹¤í–‰ ì‹œ ëŠë¦¼ | ë¹ ë¦„ (ì¿¼ë¦¬ íŒŒì‹± ìºì‹±ë¨) |
| íŒŒë¼ë¯¸í„° ì²˜ë¦¬ | ì§ì ‘ ë¬¸ìì—´ ì¡°í•© | `?`ë¡œ ë°”ì¸ë”© ê°€ëŠ¥ |

***
### ğŸš€ JDBC Template ì‹¤ìŠµ
#### â˜‘ï¸ Spring JDBCì˜ ëŒ€í‘œ ìœ í‹¸ í´ë˜ìŠ¤ `JdbcTemplate`
- JDBC ì½”ë“œì˜ ë°˜ë³µ ì œê±°
- ìì› ìë™ í•´ì œ
- SQL ì˜ˆì™¸ë¥¼ `DataAccessException`ìœ¼ë¡œ ì¶”ìƒí™”

```java
@Autowired
private JdbcTemplate jdbcTemplate;

public void insertUser(String name) {
  jdbcTemplate.update("INSERT INTO users (name) VALUES (?)", name);
}

public String findUserNameById(Long id) {
  return jdbcTemplate.queryForObject(
    "SELECT name FROM users WHERE id = ?",
    new Object[]{id},
    String.class
  );
}
```

***
#### â˜‘ï¸ RowMapperë¡œ ê°ì²´ ë§¤í•‘í•˜ê¸°
##### ğŸ”¸ `RowMapper<T>` ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„

```java
public class UserRowMapper implements RowMapper<User> {
  @Override
  public User mapRow(ResultSet rs, int rowNum) throws SQLException {
    User user = new User();
    user.setId(rs.getLong("id"));
    user.setName(rs.getString("name"));
    return user;
  }
}
```

##### ğŸ”¸ ë§¤í•‘ í™œìš©

```java
public User findUserById(Long id) {
  return jdbcTemplate.queryForObject(
    "SELECT * FROM users WHERE id = ?",
    new UserRowMapper(),
    id
  );
}
```
