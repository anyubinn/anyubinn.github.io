---
title: "[TIL] DAY54 "
categories: [ë‚´ì¼ë°°ì›€ìº í”„, TIL]
tag: [ê°œì¸ ê³¼ì œ, ë³¸ìº í”„, ]
date: 2025-05-02 20:00:00 +0900
toc_sticky: true
---
## ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ
***
### ğŸ“‚ MyBatis
#### ğŸ“Œ MyBatisë€?
- JDBC ê¸°ë°˜ ê°œë°œì˜ ë°˜ë³µì ì¸ íŒ¨í„´ì„ ì¤„ì´ê³  **SQLê³¼ JAVA ì½”ë“œë¥¼ ë¶„ë¦¬**í•˜ê¸° ìœ„í•œ SQL Mapper
- ğŸ”¹ íŠ¹ì§•
  - SQL ì¿¼ë¦¬ë¥¼ XMLë¡œ ë¶„ë¦¬í•´ **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¶„ë¦¬** ê°€ëŠ¥
  - JDBCì˜ ë°˜ë³µì„ ì¤„ì´ê³  **ë¹ ë¥¸ ê°œë°œ** ê°€ëŠ¥
  - SQLì— **ì§ì ‘ì ìœ¼ë¡œ ì§‘ì¤‘**í•  ìˆ˜ ìˆì–´ ì¿¼ë¦¬ ìµœì í™”ì— ìœ ë¦¬
- ğŸ”¸ í•œê³„ì 
  - **SQL ì§ì ‘ ì‘ì„±**ì´ í•„ìˆ˜ â†’ DB ì¢…ì†ì„± ë†’ìŒ
  - CRUDê°€ í…Œì´ë¸”ë§ˆë‹¤ ë°˜ë³µë¨ â†’ **ìƒì‚°ì„± ì €í•˜**
  - **ê°ì²´ì§€í–¥ì  íƒìƒ‰ ë¶ˆê°€ëŠ¥**, join ì¤‘ì‹¬ì˜ ì ‘ê·¼ í•„ìš”

***
#### ğŸªœ MyBatis ë™ì‘ íë¦„
1. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ `SqlSessionFactoryBuilder`ë¡œ MyBatis ì„¤ì •íŒŒì¼ ì½ìŒ
2. `SqlSessionFactory` ìƒì„±
3. ìš”ì²­ë§ˆë‹¤ `SqlSession` ìƒì„± ë° `Mapper Interface`ë¡œ ì¿¼ë¦¬ ì‹¤í–‰
4. SQL ë§¤í•‘ íŒŒì¼(XML)ì—ì„œ ì¿¼ë¦¬ë¥¼ ì°¾ì•„ ì‹¤í–‰

**í•µì‹¬ êµ¬ì„± ìš”ì†Œ**

| êµ¬ì„± ìš”ì†Œ             | ì—­í•                       |
| ----------------- | ----------------------- |
| SqlSessionFactory | ì„¤ì • íŒŒì¼ë¡œë¶€í„° ì„¸ì…˜ì„ ìƒì„±         |
| SqlSession        | ì‹¤ì œ ì¿¼ë¦¬ ì‹¤í–‰ ë° íŠ¸ëœì­ì…˜ ì œì–´      |
| Mapper Interface  | XML ì¿¼ë¦¬ì™€ Java ë©”ì†Œë“œì˜ ì—°ê²° ê³ ë¦¬ |
| Mapper XML        | SQL ì •ì˜ì™€ ë§¤í•‘ ì •ë³´ í¬í•¨        |

***
#### ğŸ¯ MyBatis êµ¬í˜„ ë°©ì‹
##### ğŸ§¾ Dao í´ë˜ìŠ¤ ì´ìš©

```java
public class UserDao {
  private final SqlSession sqlSession;
  public UserDao(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }
  public User selectUserById(long id) {
    return sqlSession.selectOne("selectUserById", id);
  }
}
```

- ìœ ì—°í•˜ì§€ë§Œ ì§ì ‘ SqlSessionì„ í˜¸ì¶œí•´ì•¼ í•˜ë¯€ë¡œ **ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´** ì¡´ì¬

##### ğŸ”— Mapper Interface ì‚¬ìš©

```java
@Mapper
public interface UserMapper {
  User selectUserById(@Param("id") Long id);
}
```

- ì¶”ìƒ ë©”ì†Œë“œì™€ XMLì˜ `id`ê°€ ìë™ìœ¼ë¡œ ì—°ê²°
- **ê°„ê²°í•œ êµ¬í˜„, IDE ìë™ ì™„ì„±, íƒ€ì… ì•ˆì •ì„±**

> â—ï¸ XML íŒŒì¼ì˜ `<mapper namespace="...">`ëŠ” ë°˜ë“œì‹œ `UserMapper ì¸í„°í˜ì´ìŠ¤ì˜ FQCNê³¼ ì¼ì¹˜í•´ì•¼ í•¨

#### ğŸ“ XML ì¿¼ë¦¬ ì˜ˆì‹œ

```xml
<mapper namespace="com.example.mapper.UserMapper">
  <select id="selectUserById" resultType="User">
    SELECT id, name FROM users WHERE id = #{id}
  </select>
</mapper>
```

***
### ğŸš€ ORM (JPA)
#### ğŸ“Œ JPAë€?

> ê°ì²´ì§€í–¥ì ìœ¼ë¡œ DBë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ í‘œì¤€ ORM ìŠ¤í™
> í•˜ì´ë²„ë„¤ì´íŠ¸ (Hibernate)ëŠ” ëŒ€í‘œì ì¸ êµ¬í˜„ì²´

#### ğŸ’¡ ì™œ ORMì´ ë“±ì¥í–ˆëŠ”ê°€?
- MyBatisëŠ” SQLì— ë„ˆë¬´ ì˜ì¡´ì  â†’ ê°ì²´ì§€í–¥ì ì¸ íƒìƒ‰ì´ ì–´ë µê³  ë°˜ë³µ ë§ìŒ
- ê°ì²´ ì¤‘ì‹¬ìœ¼ë¡œ ë„ë©”ì¸ì„ ì„¤ê³„í•˜ê³ , **DBëŠ” ë‹¨ì§€ ì €ì¥ì†Œ**ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ìŒ
- ì—°ê´€ê´€ê³„ íƒìƒ‰, ìƒì†, ì‹ë³„ ë“± ê°ì²´ì§€í–¥ì˜ íŠ¹ì„±ì— ë§ëŠ” ê¸°ìˆ ì´ í•„ìš”

#### âœ… JPAì˜ ëª©í‘œ
- SQLì´ ì•„ë‹ˆë¼ **ê°ì²´ ì¤‘ì‹¬**ìœ¼ë¡œ ê°œë°œ
- ì¿¼ë¦¬ ì‘ì„± ì—†ì´ë„ CRUD ìë™ ì§€ì›
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í†µí•œ ìºì‹± ë° ì“°ê¸° ì§€ì—° ì²˜ë¦¬

***
#### ğŸ§© ORMì´ í•´ê²°í•´ì•¼ í•  ë¬¸ì œì ê³¼ í•´ê²°ì±…

| ë¬¸ì œ    | ì„¤ëª…                   | í•´ê²°ì±…                         |
| ----- | -------------------- | --------------------------- |
| ìƒì†    | í…Œì´ë¸”ì€ ìƒì† ê°œë… ì—†ìŒ        | `@Inheritance` ì „ëµ ì‚¬ìš©        |
| ì—°ê´€ ê´€ê³„ | ê°ì²´ëŠ” ì°¸ì¡°, í…Œì´ë¸”ì€ FK      | `@ManyToOne`, `@JoinColumn` |
| íƒìƒ‰    | ê°ì²´ëŠ” getX().getY() ê°€ëŠ¥ | fetch ì „ëµ ì„¤ì •                 |
| ì‹ë³„    | ê°ì²´ëŠ” equals/hash ì‚¬ìš©   | `@Id`, `@GeneratedValue`    |
| ë¶€í”¼    | í° ê°ì²´ì˜ í…Œì´ë¸” ì €ì¥         | `@Embedded`, `@Embeddable`  |

***
#### âœˆï¸ JPAì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì“°ê¸° ì§€ì—°
##### ğŸ§  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë€?
- JPAì˜ **1ì°¨ ìºì‹œ** ì˜ì—­
- `persist()` í˜¸ì¶œ ì‹œ DBì— ë°”ë¡œ ì¿¼ë¦¬ ì „ì†¡ë˜ì§€ ì•Šê³ , ë©”ëª¨ë¦¬ì—ì„œ ê´€ë¦¬ë¨
- `flush()` ë˜ëŠ” `commit()` ì‹œì ì—ë§Œ ì‹¤ì œ DB ë°˜ì˜

##### ğŸ“¦ ìƒíƒœ íë¦„

```
new â†’ persist() â†’ managed â†’ flush â†’ commit â†’ DB ë°˜ì˜
```

- ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì—”í‹°í‹°ë¥¼ ì—¬ëŸ¬ ë²ˆ ìˆ˜ì •í•´ë„ **í•œ ë²ˆë§Œ UPDATE**
- `IDENTITY` ì „ëµì€ ì¦‰ì‹œ insert ìˆ˜í–‰ â†’ **ì“°ê¸° ì§€ì—° ë¶ˆê°€**

***
#### ğŸ¥Š Repository vs JpaRepository

| êµ¬ë¶„ | Repository          | JpaRepository          |
| -- | ------------------- | ---------------------- |
| êµ¬í˜„ | ì§ì ‘ EntityManager ì‚¬ìš© | Spring Data JPAê°€ ìë™ êµ¬í˜„ |
| ì¥ì  | ì¿¼ë¦¬ íŠœë‹ì— ìœ ë¦¬           | ë¹ ë¥¸ ê°œë°œ, ì¿¼ë¦¬ ìµœì†Œí™”          |
| ê¸°ëŠ¥ | ê¸°ë³¸ CRUDë§Œ            | CRUD + í˜ì´ì§• + ì •ë ¬ ë“± ë‹¤ì–‘   |

```java
public interface UserRepository extends JpaRepository<User, Long> {}
```

> ì¿¼ë¦¬ë¥¼ ì§ì ‘ ì“°ê³  ì‹¶ë‹¤ë©´ `@Query` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥

***
#### ğŸ“š ì—”í‹°í‹° ì„¤ê³„

```java
@Entity
@Table(name = "users")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class User {
  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  private String username;
  private String password;

  @Builder
  public User(String username, String password) {
    this.username = username;
    this.password = password;
  }

  public void updatePassword(String password) {
    this.password = password;
  }
}
```

***
#### ğŸ” ì—°ê´€ê´€ê³„ ë§¤í•‘ ì •ë¦¬

| ê´€ê³„   | ì–´ë…¸í…Œì´ì…˜         | ë°©í–¥ì„±     | ì„¤ëª…                |
| ---- | ------------- | ------- | ----------------- |
| 1:1  | `@OneToOne`   | ë‹¨ë°©í–¥/ì–‘ë°©í–¥ | ì‹¤ë¬´ì—ì„œ ì˜ ì•ˆì”€         |
| 1\:N | `@OneToMany`  | ë‹¨ë°©í–¥ ì¶”ì²œ  | FKëŠ” ìì‹ì´ ê°€ì§        |
| N:1  | `@ManyToOne`  | ì–‘ë°©í–¥ ê°€ëŠ¥  | ê°€ì¥ í”í•˜ê²Œ ì‚¬ìš©         |
| N\:M | `@ManyToMany` | ê±°ì˜ ë¹„ì¶”ì²œ  | ë§¤í•‘ í…Œì´ë¸” ì§ì ‘ ì—”í‹°í‹°í™” ì¶”ì²œ |

```java
// N:M ì˜ˆì‹œ
@Entity
public class UserChannel {
  @ManyToOne
  private User user;

  @ManyToOne
  private Channel channel;
}

```
